<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="An offline-first PWA application">
    <meta name="theme-color" content="#2c3e50">
    
    <!-- Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="icon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icon/favicon-16x16.png">
    <link rel="icon" type="image/x-icon" href="icon/favicon.ico">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- Apple Web App Meta Tags (iOS) -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Doklah">
    
    <title>Doklah</title>
</head>
<body>
    <div id="app" class="min-vh-100 d-flex flex-column">
        <header class="bg-body shadow-sm py-4">
            <div class="container d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center gap-3">
                    <img src="icon/android-chrome-512x512.png" alt="Doklah Logo" style="width: 48px; height: 48px;">
                    <div>
                        <h1 class="mb-0" data-i18n="header.title">Doklah</h1>
                        <small class="text-muted" data-i18n="header.subtitle">Pediatric Growth Assessment</small>
                    </div>
                </div>
                <button id="settingsButton" class="btn btn-outline-secondary" data-i18n="buttons.settings" title="Settings">
                    ‚öôÔ∏è Settings
                </button>
            </div>
        </header>
        
        <main class="flex-grow-1 py-4">
            <div class="container">
                <div class="row">
                    <!-- Form Section -->
                    <div class="col-lg-5">
                        <div class="card shadow-sm">
                            <div class="card-header bg-primary text-white">
                                <h5 class="mb-0" data-i18n="form.title">Patient Assessment</h5>
                            </div>
                            <div class="card-body">
                                <form id="assessmentForm">
                                    <!-- Gender Toggle -->
                                    <div class="mb-4">
                                        <label class="form-label d-block mb-2" data-i18n="form.gender">Gender *</label>
                                        <div class="btn-group w-100" role="group">
                                            <input type="radio" class="btn-check" name="gender" id="genderBoy" value="BOY" required>
                                            <label class="btn btn-outline-primary" for="genderBoy" data-i18n="form.genderBoy">
                                                üë¶ Boy
                                            </label>
                                            
                                            <input type="radio" class="btn-check" name="gender" id="genderGirl" value="GIRL">
                                            <label class="btn btn-outline-primary" for="genderGirl" data-i18n="form.genderGirl">
                                                üëß Girl
                                            </label>
                                        </div>
                                    </div>

                                    <!-- Weight Input -->
                                    <div class="mb-4">
                                        <label for="weight" class="form-label" data-i18n="form.weight">Weight (kg) *</label>
                                        <input type="number" class="form-control" id="weight" name="weight" 
                                               data-i18n-placeholder="form.weightPlaceholder" step="0.01" min="0.01" max="150" required>
                                        <small class="text-muted" data-i18n="form.weightRequired">Required field</small>
                                    </div>

                                    <!-- Height Input -->
                                    <div class="mb-4">
                                        <label for="height" class="form-label" data-i18n="form.height">Height (cm)</label>
                                        <input type="number" class="form-control" id="height" name="height" 
                                               data-i18n-placeholder="form.heightPlaceholder" step="any" min="0.01" max="220">
                                        <small class="text-muted" data-i18n="form.heightOptional">Optional - leave blank if unknown</small>
                                    </div>

                                    <!-- Age Select -->
                                    <div class="mb-4">
                                        <label for="age" class="form-label" data-i18n="form.age">Age *</label>
                                        <select class="form-select" id="age" name="age" required>
                                            <option value="">Select age</option>
                                        </select>
                                        <small class="text-muted" data-i18n="form.ageRequired">Required field</small>
                                    </div>

                                    <!-- Submit Button -->
                                    <button type="submit" class="btn btn-primary w-100" data-i18n="form.submit">
                                        Calculate Expected Values
                                    </button>
                                </form>

                                <!-- Error Messages -->
                                <div id="formErrors" class="alert alert-danger mt-3" style="display: none;">
                                    <small id="errorList"></small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Results Section -->
                    <div class="col-lg-7">
                        <div id="resultsContainer" style="display: none;">
                            <div class="card shadow-sm mb-3">
                                <div class="card-header bg-success text-white">
                                    <h5 class="mb-0" data-i18n="results.title">Assessment Results</h5>
                                </div>
                                <div class="card-body">
                                    <!-- Closeness Indicator -->
                                    <div class="mb-4">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <strong data-i18n="results.matchQuality">Match Quality</strong>
                                            <span id="closenessLabel" class="badge bg-info"></span>
                                        </div>
                                        <div class="progress" style="height: 24px;">
                                            <div id="closenessBar" class="progress-bar" role="progressbar" style="width: 0%;"></div>
                                        </div>
                                        <small class="text-muted d-block mt-1" id="closenessPercentage"></small>
                                    </div>

                                    <!-- Comparison Table -->
                                    <div class="table-responsive">
                                        <table class="table table-sm mb-4">
                                            <thead>
                                                <tr>
                                                    <th data-i18n="results.metric">Metric</th>
                                                    <th data-i18n="results.inputData">Input Data</th>
                                                    <th data-i18n="results.forYourAge">For Your Age</th>
                                                    <th data-i18n="results.closestMatch">Closest Match</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td><strong data-i18n="results.gender">Gender</strong></td>
                                                    <td><span id="resultInputGender"></span></td>
                                                    <td><span id="resultAgeMatchGender"></span></td>
                                                    <td><span id="resultWeightMatchGender"></span></td>
                                                </tr>
                                                <tr>
                                                    <td><strong data-i18n="results.weight">Weight (kg)</strong></td>
                                                    <td><span id="resultInputWeight"></span></td>
                                                    <td><span id="resultAgeMatchWeight"></span></td>
                                                    <td><span id="resultWeightMatchWeight"></span></td>
                                                </tr>
                                                <tr>
                                                    <td><strong data-i18n="results.height">Height (cm)</strong></td>
                                                    <td><span id="resultInputHeight" data-i18n="results.notProvided">Not provided</span></td>
                                                    <td><span id="resultAgeMatchHeight"></span></td>
                                                    <td><span id="resultWeightMatchHeight"></span></td>
                                                </tr>
                                                <tr>
                                                    <td><strong data-i18n="results.age">Age</strong></td>
                                                    <td><span id="resultInputAge"></span></td>
                                                    <td><span id="resultAgeMatchAge"></span></td>
                                                    <td><span id="resultWeightMatchAge"></span></td>
                                                </tr>
                                                <tr class="table-info">
                                                    <td><strong data-i18n="results.growthStage">Growth Stage</strong></td>
                                                    <td><span id="resultInputStage"></span></td>
                                                    <td><span id="resultAgeMatchStage"></span></td>
                                                    <td><span id="resultWeightMatchStage"></span></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>

                                    <!-- Action Buttons -->
                                    <div class="d-flex gap-2">
                                        <button id="backButton" class="btn btn-primary flex-grow-1" data-i18n="buttons.back">
                                            ‚Üê Back
                                        </button>
                                        <button id="chartButton" class="btn btn-outline-secondary flex-grow-1" data-i18n="buttons.chart">
                                            üìä View Growth Chart
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Empty State -->
                        <div id="emptyState" class="card shadow-sm">
                            <div class="card-body text-center py-5">
                                <div style="font-size: 3rem; margin-bottom: 1rem;">üìã</div>
                                <h5 data-i18n="emptyState.title">No Assessment Yet</h5>
                                <p class="text-muted mb-0" data-i18n="emptyState.message">Fill in the form and click "Calculate Expected Values" to see results</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Chart Modal -->
        <div id="chartModal" class="modal fade" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" data-i18n="chart.title">Growth Chart</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <!-- Chart Toggle -->
                        <div class="btn-group w-100 mb-4" role="group">
                            <input type="radio" class="btn-check" name="chartType" id="weightChart" value="weight" checked>
                            <label class="btn btn-outline-primary" for="weightChart" data-i18n="chart.weight">
                                ‚öñÔ∏è Weight by Age
                            </label>
                            
                            <input type="radio" class="btn-check" name="chartType" id="heightChart" value="height">
                            <label class="btn btn-outline-primary" for="heightChart" data-i18n="chart.height">
                                üìè Height by Age
                            </label>
                        </div>

                        <!-- SVG Chart Container -->
                        <div style="overflow-x: auto; background-color: #f8f9fa; padding: 1rem; border-radius: 0.25rem;">
                            <svg id="chartSvg" style="min-height: 400px; width: 100%; display: block;"></svg>
                        </div>

                        <!-- Legend -->
                        <div class="mt-3 text-center small text-muted">
                            <span class="me-3"><span style="display: inline-block; width: 12px; height: 12px; background-color: #2c3e50; border-radius: 50%;"></span> Growth curve</span>
                            <span><span style="display: inline-block; width: 12px; height: 12px; background-color: #dc3545; border-radius: 50%;"></span> Patient</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="text-center py-3 mt-auto border-top">
            <small class="text-muted" data-i18n="footer.version">Doklah v1.0 | Offline-First Pediatric Assessment</small>
        </footer>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal fade" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" data-i18n="settings.title">Settings</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Language Selection -->
                    <div class="mb-4">
                        <label for="languageSelect" class="form-label" data-i18n="settings.language">Language</label>
                        <select class="form-select" id="languageSelect">
                            <option value="en">English</option>
                            <option value="es">Espa√±ol</option>
                            <option value="pt">Portugu√™s</option>
                            <option value="fr">Fran√ßais</option>
                            <option value="id">Bahasa Indonesia</option>
                            <option value="ja">Êó•Êú¨Ë™û</option>
                        </select>
                    </div>

                    <!-- Dark Mode Toggle (TODO) -->
                    <div class="mb-4">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="darkModeToggle">
                            <label class="form-label" for="darkModeToggle" data-i18n="settings.darkMode">
                                Dark Mode
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="settings.close">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="settings.js"></script>
    <script src="i18n.js"></script>
    <script src="health.js"></script>
    <script src="chart.js"></script>
    <script src="app.js"></script>
</body>
</html>
